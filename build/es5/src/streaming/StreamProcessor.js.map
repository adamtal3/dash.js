{"version":3,"sources":["../../../../src/streaming/StreamProcessor.js"],"names":["Constants","LiveEdgeFinder","BufferController","TextBufferController","ScheduleController","RepresentationController","FactoryMaker","DashHandler","StreamProcessor","config","context","type","errHandler","mimeType","timelineConverter","adapter","manifestModel","mediaPlayerModel","stream","abrController","playbackController","streamController","mediaController","textController","domStorage","metricsModel","dashMetrics","dashManifestModel","instance","mediaInfo","mediaInfoArr","bufferController","scheduleController","liveEdgeFinder","representationController","fragmentModel","spExternalControllers","indexHandler","setup","getIsDynamic","create","streamProcessor","resetInitialSettings","initialize","mediaSource","baseURLController","registerStreamType","getFragmentController","getModel","setStreamProcessor","createBufferControllerForType","setConfig","registerExternalController","controller","push","unregisterExternalController","index","indexOf","splice","getExternalControllers","unregisterAllExternalController","reset","errored","keepBuffers","unRegisterStreamType","forEach","isUpdating","getType","getRepresentationController","getIndexHandler","getBuffer","setBuffer","buffer","getBufferController","getFragmentModel","getLiveEdgeFinder","getStreamInfo","addInbandEvents","events","selectMediaInfo","newMediaInfo","updateData","addMediaInfo","selectNewMediaInfo","getMediaInfoArr","getMediaInfo","getMediaSource","setMediaSource","dischargePreBuffer","getScheduleController","getRepresentationInfo","quality","isBufferingCompleted","getIsBufferingCompleted","timeIsBuffered","time","getRangeAt","getBufferLevel","switchInitData","representationId","bufferResetEnabled","id","createBuffer","previousBuffers","switchTrackAsked","VIDEO","AUDIO","__dashjs_factory_name","getClassFactory"],"mappings":"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","file":"StreamProcessor.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport Constants from './constants/Constants';\nimport LiveEdgeFinder from './utils/LiveEdgeFinder';\nimport BufferController from './controllers/BufferController';\nimport TextBufferController from './text/TextBufferController';\nimport ScheduleController from './controllers/ScheduleController';\nimport RepresentationController from '../dash/controllers/RepresentationController';\nimport FactoryMaker from '../core/FactoryMaker';\n\nimport DashHandler from '../dash/DashHandler';\n\nfunction StreamProcessor(config) {\n\n    config = config || {};\n    let context = this.context;\n\n    let type = config.type;\n    let errHandler = config.errHandler;\n    let mimeType = config.mimeType;\n    let timelineConverter = config.timelineConverter;\n    let adapter = config.adapter;\n    let manifestModel = config.manifestModel;\n    let mediaPlayerModel = config.mediaPlayerModel;\n    let stream = config.stream;\n    let abrController = config.abrController;\n    let playbackController = config.playbackController;\n    let streamController = config.streamController;\n    let mediaController = config.mediaController;\n    let textController = config.textController;\n    let domStorage = config.domStorage;\n    let metricsModel = config.metricsModel;\n    let dashMetrics = config.dashMetrics;\n    let dashManifestModel = config.dashManifestModel;\n\n    let instance,\n        mediaInfo,\n        mediaInfoArr,\n        bufferController,\n        scheduleController,\n        liveEdgeFinder,\n        representationController,\n        fragmentModel,\n        spExternalControllers,\n        indexHandler;\n\n    function setup() {\n        if (playbackController && playbackController.getIsDynamic()) {\n            liveEdgeFinder = LiveEdgeFinder(context).create({\n                timelineConverter: timelineConverter,\n                streamProcessor: instance\n            });\n        }\n        resetInitialSettings();\n    }\n\n    function initialize(mediaSource) {\n        indexHandler = DashHandler(context).create({\n            mimeType: mimeType,\n            timelineConverter: timelineConverter,\n            dashMetrics: dashMetrics,\n            metricsModel: metricsModel,\n            mediaPlayerModel: mediaPlayerModel,\n            baseURLController: config.baseURLController,\n            errHandler: errHandler\n        });\n\n        // initialize controllers\n        indexHandler.initialize(instance);\n        abrController.registerStreamType(type, instance);\n\n        fragmentModel = stream.getFragmentController().getModel(type);\n        fragmentModel.setStreamProcessor(instance);\n\n        bufferController = createBufferControllerForType(type);\n        scheduleController = ScheduleController(context).create({\n            type: type,\n            mimeType: mimeType,\n            metricsModel: metricsModel,\n            adapter: adapter,\n            dashMetrics: dashMetrics,\n            dashManifestModel: dashManifestModel,\n            timelineConverter: timelineConverter,\n            mediaPlayerModel: mediaPlayerModel,\n            abrController: abrController,\n            playbackController: playbackController,\n            streamController: streamController,\n            textController: textController,\n            streamProcessor: instance,\n            mediaController: mediaController\n        });\n        representationController = RepresentationController(context).create();\n        representationController.setConfig({\n            abrController: abrController,\n            domStorage: domStorage,\n            metricsModel: metricsModel,\n            dashMetrics: dashMetrics,\n            dashManifestModel: dashManifestModel,\n            manifestModel: manifestModel,\n            playbackController: playbackController,\n            timelineConverter: timelineConverter,\n            streamProcessor: instance\n        });\n        bufferController.initialize(mediaSource);\n        scheduleController.initialize();\n        representationController.initialize();\n    }\n\n    function registerExternalController(controller) {\n        spExternalControllers.push(controller);\n    }\n\n    function unregisterExternalController(controller) {\n        var index = spExternalControllers.indexOf(controller);\n\n        if (index !== -1) {\n            spExternalControllers.splice(index, 1);\n        }\n    }\n\n    function getExternalControllers() {\n        return spExternalControllers;\n    }\n\n    function unregisterAllExternalController() {\n        spExternalControllers = [];\n    }\n\n    function resetInitialSettings() {\n        mediaInfoArr = [];\n        mediaInfo = null;\n        unregisterAllExternalController();\n    }\n\n    function reset(errored, keepBuffers) {\n        indexHandler.reset();\n\n        if (bufferController) {\n            bufferController.reset(errored, keepBuffers);\n            bufferController = null;\n        }\n\n        if (scheduleController) {\n            scheduleController.reset();\n            scheduleController = null;\n        }\n\n        if (representationController) {\n            representationController.reset();\n            representationController = null;\n        }\n\n        if (abrController) {\n            abrController.unRegisterStreamType(type);\n        }\n        spExternalControllers.forEach(function (controller) {\n            controller.reset();\n        });\n\n        resetInitialSettings();\n        type = null;\n        stream = null;\n        if (liveEdgeFinder) {\n            liveEdgeFinder.reset();\n            liveEdgeFinder = null;\n        }\n    }\n\n    function isUpdating() {\n        return representationController ? representationController.isUpdating() : false;\n    }\n\n    function getType() {\n        return type;\n    }\n\n    function getRepresentationController() {\n        return representationController;\n    }\n\n    function getIndexHandler() {\n        return indexHandler;\n    }\n\n    function getFragmentController() {\n        return stream ? stream.getFragmentController() : null;\n    }\n\n    function getBuffer() {\n        return bufferController.getBuffer();\n    }\n\n    function setBuffer(buffer) {\n        bufferController.setBuffer(buffer);\n    }\n\n    function getBufferController() {\n        return bufferController;\n    }\n\n    function getFragmentModel() {\n        return fragmentModel;\n    }\n\n    function getLiveEdgeFinder() {\n        return liveEdgeFinder;\n    }\n\n    function getStreamInfo() {\n        return stream ? stream.getStreamInfo() : null;\n    }\n\n    function addInbandEvents(events) {\n        if (stream) {\n            stream.addInbandEvents(events);\n        }\n    }\n\n    function selectMediaInfo(newMediaInfo) {\n        if (newMediaInfo !== mediaInfo && (!newMediaInfo || !mediaInfo || (newMediaInfo.type === mediaInfo.type))) {\n            mediaInfo = newMediaInfo;\n        }\n        adapter.updateData(this);\n    }\n\n    function addMediaInfo(newMediaInfo, selectNewMediaInfo) {\n        if (mediaInfoArr.indexOf(newMediaInfo) === -1) {\n            mediaInfoArr.push(newMediaInfo);\n        }\n\n        if (selectNewMediaInfo) {\n            this.selectMediaInfo(newMediaInfo);\n        }\n    }\n\n    function getMediaInfoArr() {\n        return mediaInfoArr;\n    }\n\n    function getMediaInfo() {\n        return mediaInfo;\n    }\n\n    function getMediaSource() {\n        return bufferController.getMediaSource();\n    }\n\n    function setMediaSource(mediaSource) {\n        bufferController.setMediaSource(mediaSource, getMediaInfo());\n    }\n\n    function dischargePreBuffer() {\n        bufferController.dischargePreBuffer();\n    }\n\n    function getScheduleController() {\n        return scheduleController;\n    }\n\n    function getRepresentationInfo(quality) {\n        return adapter.getRepresentationInfo(representationController, quality);\n    }\n\n    function isBufferingCompleted() {\n        if (bufferController) {\n            return bufferController.getIsBufferingCompleted();\n        }\n\n        return false;\n    }\n\n    function timeIsBuffered(time) {\n        if (bufferController) {\n            return bufferController.getRangeAt(time, 0) !== null;\n        }\n\n        return false;\n    }\n\n    function getBufferLevel() {\n        return bufferController.getBufferLevel();\n    }\n\n    function switchInitData(representationId, bufferResetEnabled) {\n        if (bufferController) {\n            bufferController.switchInitData(getStreamInfo().id, representationId, bufferResetEnabled);\n        }\n    }\n\n    function createBuffer(previousBuffers) {\n        return (bufferController.getBuffer() || bufferController.createBuffer(mediaInfo, previousBuffers));\n    }\n\n    function switchTrackAsked() {\n        scheduleController.switchTrackAsked();\n    }\n\n    function createBufferControllerForType(type) {\n        let controller = null;\n\n        if (type === Constants.VIDEO || type === Constants.AUDIO) {\n            controller = BufferController(context).create({\n                type: type,\n                metricsModel: metricsModel,\n                mediaPlayerModel: mediaPlayerModel,\n                manifestModel: manifestModel,\n                errHandler: errHandler,\n                streamController: streamController,\n                mediaController: mediaController,\n                adapter: adapter,\n                textController: textController,\n                abrController: abrController,\n                playbackController: playbackController,\n                streamProcessor: instance\n            });\n        } else {\n            controller = TextBufferController(context).create({\n                type: type,\n                mimeType: mimeType,\n                metricsModel: metricsModel,\n                mediaPlayerModel: mediaPlayerModel,\n                manifestModel: manifestModel,\n                errHandler: errHandler,\n                streamController: streamController,\n                mediaController: mediaController,\n                adapter: adapter,\n                textController: textController,\n                abrController: abrController,\n                playbackController: playbackController,\n                streamProcessor: instance\n            });\n        }\n\n        return controller;\n    }\n\n    instance = {\n        initialize: initialize,\n        isUpdating: isUpdating,\n        getType: getType,\n        getBufferController: getBufferController,\n        getFragmentModel: getFragmentModel,\n        getScheduleController: getScheduleController,\n        getLiveEdgeFinder: getLiveEdgeFinder,\n        getFragmentController: getFragmentController,\n        getRepresentationController: getRepresentationController,\n        getIndexHandler: getIndexHandler,\n        getRepresentationInfo: getRepresentationInfo,\n        getBufferLevel: getBufferLevel,\n        switchInitData: switchInitData,\n        isBufferingCompleted: isBufferingCompleted,\n        timeIsBuffered: timeIsBuffered,\n        createBuffer: createBuffer,\n        getStreamInfo: getStreamInfo,\n        selectMediaInfo: selectMediaInfo,\n        addMediaInfo: addMediaInfo,\n        switchTrackAsked: switchTrackAsked,\n        getMediaInfoArr: getMediaInfoArr,\n        getMediaInfo: getMediaInfo,\n        getMediaSource: getMediaSource,\n        setMediaSource: setMediaSource,\n        dischargePreBuffer: dischargePreBuffer,\n        getBuffer: getBuffer,\n        setBuffer: setBuffer,\n        registerExternalController: registerExternalController,\n        unregisterExternalController: unregisterExternalController,\n        getExternalControllers: getExternalControllers,\n        unregisterAllExternalController: unregisterAllExternalController,\n        addInbandEvents: addInbandEvents,\n        reset: reset\n    };\n\n    setup();\n\n    return instance;\n}\nStreamProcessor.__dashjs_factory_name = 'StreamProcessor';\nexport default FactoryMaker.getClassFactory(StreamProcessor);\n"]}