{"version":3,"sources":["../../../../../src/streaming/controllers/XlinkController.js"],"names":["XlinkLoader","EventBus","Events","FactoryMaker","X2JS","URLUtils","DashConstants","RESOLVE_TYPE_ONLOAD","RESOLVE_TYPE_ONACTUATE","RESOLVE_TO_ZERO","XlinkController","config","context","eventBus","getInstance","urlUtils","instance","matchers","iron","manifest","converter","xlinkLoader","setup","on","XLINK_ELEMENT_LOADED","onXlinkElementLoaded","create","errHandler","metricsModel","mediaPlayerModel","requestModifier","setMatchers","value","setIron","resolveManifestOnLoad","mpd","elements","escapeMode","attributePrefix","arrayAccessForm","emptyNodeForm","stripWhitespaces","enableToStringFunc","ignoreRoot","getElementsToResolve","Period_asArray","PERIOD","resolve","reset","off","type","resolveType","resolveObject","element","url","length","onXlinkAllElementsLoaded","i","isHTTPURL","originalContent","BaseURL","load","event","openingTag","closingTag","mergedContent","resolvedContent","index","indexOf","substr","xml_str2json","isResolvingFinished","obj","mergeElementsBack","trigger","XLINK_READY","hasOwnProperty","ADAPTATION_SET","concat","EVENT_STREAM","parentElement","toResolve","xlinkObject","splice","createXlinkObject","push","resolvedElements","j","k","isInappropriateTarget","run","resolved","elementsToResolve","__dashjs_factory_name","getClassFactory"],"mappings":"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","file":"XlinkController.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport XlinkLoader from '../XlinkLoader';\nimport EventBus from '../../core/EventBus';\nimport Events from '../../core/events/Events';\nimport FactoryMaker from '../../core/FactoryMaker';\nimport X2JS from '../../../externals/xml2json';\nimport URLUtils from '../utils/URLUtils';\nimport DashConstants from '../../dash/constants/DashConstants';\n\nconst RESOLVE_TYPE_ONLOAD = 'onLoad';\nconst RESOLVE_TYPE_ONACTUATE = 'onActuate';\nconst RESOLVE_TO_ZERO = 'urn:mpeg:dash:resolve-to-zero:2013';\n\nfunction XlinkController(config) {\n\n    config = config || {};\n    let context = this.context;\n    let eventBus = EventBus(context).getInstance();\n    const urlUtils = URLUtils(context).getInstance();\n\n    let instance,\n        matchers,\n        iron,\n        manifest,\n        converter,\n        xlinkLoader;\n\n    function setup() {\n        eventBus.on(Events.XLINK_ELEMENT_LOADED, onXlinkElementLoaded, instance);\n\n        xlinkLoader = XlinkLoader(context).create({\n            errHandler: config.errHandler,\n            metricsModel: config.metricsModel,\n            mediaPlayerModel: config.mediaPlayerModel,\n            requestModifier: config.requestModifier\n        });\n    }\n\n    function setMatchers(value) {\n        if (value) {\n            matchers = value;\n        }\n    }\n\n    function setIron(value) {\n        if (value) {\n            iron = value;\n        }\n    }\n\n    /**\n     * <p>Triggers the resolution of the xlink.onLoad attributes in the manifest file </p>\n     * @param {Object} mpd - the manifest\n     */\n    function resolveManifestOnLoad(mpd) {\n        let elements;\n        // First resolve all periods, so unnecessary requests inside onLoad Periods with Default content are avoided\n        converter = new X2JS({\n            escapeMode:         false,\n            attributePrefix:    '',\n            arrayAccessForm:    'property',\n            emptyNodeForm:      'object',\n            stripWhitespaces:   false,\n            enableToStringFunc: false,\n            ignoreRoot:         true,\n            matchers:           matchers\n        });\n\n        manifest = mpd;\n        elements = getElementsToResolve(manifest.Period_asArray, manifest, DashConstants.PERIOD, RESOLVE_TYPE_ONLOAD);\n        resolve(elements, DashConstants.PERIOD, RESOLVE_TYPE_ONLOAD);\n    }\n\n    function reset() {\n        eventBus.off(Events.XLINK_ELEMENT_LOADED, onXlinkElementLoaded, instance);\n\n        if (xlinkLoader) {\n            xlinkLoader.reset();\n            xlinkLoader = null;\n        }\n    }\n\n    function resolve(elements, type, resolveType) {\n        let resolveObject = {};\n        let element,\n            url;\n\n        resolveObject.elements = elements;\n        resolveObject.type = type;\n        resolveObject.resolveType = resolveType;\n        // If nothing to resolve, directly call allElementsLoaded\n        if (resolveObject.elements.length === 0) {\n            onXlinkAllElementsLoaded(resolveObject);\n        }\n        for (let i = 0; i < resolveObject.elements.length; i++) {\n            element = resolveObject.elements[i];\n            if (urlUtils.isHTTPURL(element.url)) {\n                url = element.url;\n            } else {\n                url = element.originalContent.BaseURL + element.url;\n            }\n            xlinkLoader.load(url, element, resolveObject);\n        }\n    }\n\n    function onXlinkElementLoaded(event) {\n        let element,\n            resolveObject;\n\n        const openingTag = '<response>';\n        const closingTag = '</response>';\n        let mergedContent = '';\n\n        element = event.element;\n        resolveObject = event.resolveObject;\n        // if the element resolved into content parse the content\n        if (element.resolvedContent) {\n            let index = 0;\n            // we add a parent elements so the converter is able to parse multiple elements of the same type which are not wrapped inside a container\n            if (element.resolvedContent.indexOf('<?xml') === 0) {\n                index = element.resolvedContent.indexOf('?>') + 2; //find the closing position of the xml declaration, if it exists.\n            }\n            mergedContent = element.resolvedContent.substr(0,index) + openingTag + element.resolvedContent.substr(index) + closingTag;\n            element.resolvedContent = converter.xml_str2json(mergedContent);\n        }\n        if (isResolvingFinished(resolveObject)) {\n            onXlinkAllElementsLoaded(resolveObject);\n        }\n    }\n\n    // We got to wait till all elements of the current queue are resolved before merging back\n    function onXlinkAllElementsLoaded (resolveObject) {\n        let elements = [];\n        let i,\n            obj;\n\n        mergeElementsBack(resolveObject);\n        if (resolveObject.resolveType === RESOLVE_TYPE_ONACTUATE) {\n            eventBus.trigger(Events.XLINK_READY, {manifest: manifest});\n        }\n        if (resolveObject.resolveType === RESOLVE_TYPE_ONLOAD) {\n            switch (resolveObject.type) {\n                // Start resolving the other elements. We can do Adaptation Set and EventStream in parallel\n                case DashConstants.PERIOD:\n                    for (i = 0; i < manifest[DashConstants.PERIOD + '_asArray'].length; i++) {\n                        obj = manifest[DashConstants.PERIOD + '_asArray'][i];\n                        if (obj.hasOwnProperty(DashConstants.ADAPTATION_SET + '_asArray')) {\n                            elements = elements.concat(getElementsToResolve(obj[DashConstants.ADAPTATION_SET + '_asArray'], obj, DashConstants.ADAPTATION_SET, RESOLVE_TYPE_ONLOAD));\n                        }\n                        if (obj.hasOwnProperty(DashConstants.EVENT_STREAM + '_asArray')) {\n                            elements = elements.concat(getElementsToResolve(obj[DashConstants.EVENT_STREAM + '_asArray'], obj, DashConstants.EVENT_STREAM, RESOLVE_TYPE_ONLOAD));\n                        }\n                    }\n                    resolve(elements, DashConstants.ADAPTATION_SET, RESOLVE_TYPE_ONLOAD);\n                    break;\n                case DashConstants.ADAPTATION_SET:\n                    // TODO: Resolve SegmentList here\n                    eventBus.trigger(Events.XLINK_READY, {manifest: manifest});\n                    break;\n            }\n        }\n    }\n\n    // Returns the elements with the specific resolve Type\n    function getElementsToResolve(elements, parentElement, type, resolveType) {\n        let toResolve = [];\n        let element,\n            i,\n            xlinkObject;\n        // first remove all the resolve-to-zero elements\n        for (i = elements.length - 1; i >= 0; i--) {\n            element = elements[i];\n            if (element.hasOwnProperty('xlink:href') && element['xlink:href'] === RESOLVE_TO_ZERO) {\n                elements.splice(i, 1);\n            }\n        }\n        // now get the elements with the right resolve type\n        for (i = 0; i < elements.length; i++) {\n            element = elements[i];\n            if (element.hasOwnProperty('xlink:href') && element.hasOwnProperty('xlink:actuate') && element['xlink:actuate'] === resolveType) {\n                xlinkObject = createXlinkObject(element['xlink:href'], parentElement, type, i, resolveType, element);\n                toResolve.push(xlinkObject);\n            }\n        }\n        return toResolve;\n    }\n\n    function mergeElementsBack(resolveObject) {\n        let resolvedElements = [];\n        let element,\n            type,\n            obj,\n            i,\n            j,\n            k;\n        // Start merging back from the end because of index shifting. Note that the elements with the same parent have to be ordered by index ascending\n        for (i = resolveObject.elements.length - 1; i >= 0; i --) {\n            element = resolveObject.elements[i];\n            type = element.type + '_asArray';\n\n            // Element couldn't be resolved or is TODO Inappropriate target: Remove all Xlink attributes\n            if (!element.resolvedContent || isInappropriateTarget()) {\n                delete element.originalContent['xlink:actuate'];\n                delete element.originalContent['xlink:href'];\n                resolvedElements.push(element.originalContent);\n            }\n            // Element was successfully resolved\n            else if (element.resolvedContent) {\n                for (j = 0; j < element.resolvedContent[type].length; j++) {\n                    //TODO Contains another Xlink attribute with xlink:actuate set to onload. Remove all xLink attributes\n                    obj = element.resolvedContent[type][j];\n                    resolvedElements.push(obj);\n                }\n            }\n            // Replace the old elements in the parent with the resolved ones\n            element.parentElement[type].splice(element.index, 1);\n            for (k = 0; k < resolvedElements.length; k++) {\n                element.parentElement[type].splice(element.index + k, 0, resolvedElements[k]);\n            }\n            resolvedElements = [];\n        }\n        if (resolveObject.elements.length > 0) {\n            iron.run(manifest);\n        }\n    }\n\n    function createXlinkObject(url, parentElement, type, index, resolveType, originalContent) {\n        return {\n            url: url,\n            parentElement: parentElement,\n            type: type,\n            index: index,\n            resolveType: resolveType,\n            originalContent: originalContent,\n            resolvedContent: null,\n            resolved: false\n        };\n    }\n\n    // Check if all pending requests are finished\n    function isResolvingFinished(elementsToResolve) {\n        let i,\n            obj;\n        for (i = 0; i < elementsToResolve.elements.length; i++) {\n            obj = elementsToResolve.elements[i];\n            if (obj.resolved === false) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    // TODO : Do some syntax check here if the target is valid or not\n    function isInappropriateTarget() {\n        return false;\n    }\n\n    instance = {\n        resolveManifestOnLoad: resolveManifestOnLoad,\n        setMatchers: setMatchers,\n        setIron: setIron,\n        reset: reset\n    };\n\n    setup();\n    return instance;\n}\n\nXlinkController.__dashjs_factory_name = 'XlinkController';\nexport default FactoryMaker.getClassFactory(XlinkController);\n"]}