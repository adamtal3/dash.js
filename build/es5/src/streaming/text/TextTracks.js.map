{"version":3,"sources":["../../../../../src/streaming/text/TextTracks.js"],"names":["Constants","EventBus","Events","FactoryMaker","Debug","renderHTML","TextTracks","context","eventBus","getInstance","instance","logger","Cue","videoModel","textTrackQueue","trackElementArr","currentTrackIdx","actualVideoLeft","actualVideoTop","actualVideoWidth","actualVideoHeight","captionContainer","videoSizeCheckInterval","fullscreenAttribute","displayCCOnTop","previousISDState","topZIndex","setup","getLogger","initialize","window","navigator","VTTCue","TextTrackCue","document","fullscreenElement","undefined","webkitIsFullScreen","msFullscreenElement","mozFullScreen","createTrackForUserAgent","i","kind","label","id","lang","isTTML","isEmbedded","track","addTextTrack","displayCConTop","value","style","zIndex","textTrackInfoVO","totalTextTracks","length","error","push","sort","a","b","index","getTTMLRenderingDiv","defaultIndex","call","defaultTrack","default","textTrack","getTrackByIdx","mode","TEXT_SHOWING","renderingType","addCaptions","captionData","trigger","TEXT_TRACK_ADDED","setCurrentTrackIdx","idx","videoTextTrack","TEXT_HIDDEN","TEXT_TRACKS_QUEUE_INITIALIZED","tracks","getVideoVisibleVideoSize","viewWidth","viewHeight","videoWidth","videoHeight","aspectRatio","use80Percent","viewAspectRatio","videoAspectRatio","videoPictureWidth","videoPictureHeight","videoPictureXAspect","videoPictureYAspect","videoPictureWidthAspect","videoPictureHeightAspect","videoPictureAspect","x","y","w","h","checkVideoSize","forceDrawing","clientWidth","getClientWidth","clientHeight","getClientHeight","getVideoWidth","getVideoHeight","videoOffsetTop","getVideoRelativeOffsetTop","videoOffsetLeft","getVideoRelativeOffsetLeft","isFromCEA608","realVideoSize","newVideoWidth","newVideoHeight","newVideoLeft","newVideoTop","containerStyle","left","top","width","height","CAPTION_CONTAINER_RESIZE","activeCues","len","cue","scaleCue","activeCue","key","replaceValue","valueFontSize","valueLineHeight","elements","cellResolution","cellUnit","linePadding","hasOwnProperty","valueLinePadding","toString","elementsSpan","getElementsByClassName","cssText","replace","fontSize","j","lineHeight","k","isd","htmlCaptionDiv","getElementById","cueID","removeChild","renderCaption","finalCue","createElement","appendChild","uri","imsc1ImgUrnTester","smpteImgUrnTester","test","match","exec","imageId","parseInt","imageData","btoa","images","dataUrl","embeddedImages","err","info","CAPTION_RENDERED","captionDiv","trackIdx","timeOffset","self","item","currentItem","type","start","end","cueHTMLElement","bind","onenter","debug","onexit","divs","childNodes","data","styles","align","line","position","size","addCue","e","deleteTrackCues","getTextTrack","getCurrentTrackIdx","getTrackIdxForId","trackId","setCueStyleOnTrack","clearInterval","setInterval","clearCaptionContainer","setNativeCueStyle","removeNativeCueStyle","cues","lastIdx","r","removeCue","deleteCuesFromTrackIdx","deleteAllTextTracks","ln","deleteTextTrack","splice","styleElement","head","stylesheet","sheet","video","getElement","insertRule","classList","className","message","firstChild","setConfig","config","setModeForTrackIdx","getCurrentTrackInfo","__dashjs_factory_name","getSingletonFactory"],"mappings":"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","file":"TextTracks.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport Constants from '../constants/Constants';\nimport EventBus from '../../core/EventBus';\nimport Events from '../../core/events/Events';\nimport FactoryMaker from '../../core/FactoryMaker';\nimport Debug from '../../core/Debug';\nimport { renderHTML } from 'imsc';\n\nfunction TextTracks() {\n\n    const context = this.context;\n    const eventBus = EventBus(context).getInstance();\n\n    let instance,\n        logger,\n        Cue,\n        videoModel,\n        textTrackQueue,\n        trackElementArr,\n        currentTrackIdx,\n        actualVideoLeft,\n        actualVideoTop,\n        actualVideoWidth,\n        actualVideoHeight,\n        captionContainer,\n        videoSizeCheckInterval,\n        fullscreenAttribute,\n        displayCCOnTop,\n        previousISDState,\n        topZIndex;\n\n    function setup() {\n        logger = Debug(context).getInstance().getLogger(instance);\n    }\n\n    function initialize() {\n        if (typeof window === 'undefined' || typeof navigator === 'undefined') {\n            return;\n        }\n\n        Cue = window.VTTCue || window.TextTrackCue;\n        textTrackQueue = [];\n        trackElementArr = [];\n        currentTrackIdx = -1;\n        actualVideoLeft = 0;\n        actualVideoTop = 0;\n        actualVideoWidth = 0;\n        actualVideoHeight = 0;\n        captionContainer = null;\n        videoSizeCheckInterval = null;\n        displayCCOnTop = false;\n        topZIndex = 2147483647;\n        previousISDState = null;\n\n        if (document.fullscreenElement !== undefined) {\n            fullscreenAttribute = 'fullscreenElement'; // Standard and Edge\n        } else if (document.webkitIsFullScreen !== undefined) {\n            fullscreenAttribute = 'webkitIsFullScreen'; // Chrome and Safari (and Edge)\n        } else if (document.msFullscreenElement) { // IE11\n            fullscreenAttribute = 'msFullscreenElement';\n        } else if (document.mozFullScreen) { // Firefox\n            fullscreenAttribute = 'mozFullScreen';\n        }\n\n    }\n\n    function createTrackForUserAgent (i) {\n        const kind = textTrackQueue[i].kind;\n        const label = textTrackQueue[i].id !== undefined ? textTrackQueue[i].id : textTrackQueue[i].lang;\n        const lang = textTrackQueue[i].lang;\n        const isTTML = textTrackQueue[i].isTTML;\n        const isEmbedded = textTrackQueue[i].isEmbedded;\n        const track = videoModel.addTextTrack(kind, label, lang);\n\n        track.isEmbedded = isEmbedded;\n        track.isTTML = isTTML;\n\n        return track;\n    }\n\n    function displayCConTop(value) {\n        displayCCOnTop = value;\n        if (!captionContainer || document[fullscreenAttribute]) {\n            return;\n        }\n        captionContainer.style.zIndex = value ? topZIndex : null;\n    }\n\n    function addTextTrack(textTrackInfoVO, totalTextTracks) {\n        if (textTrackQueue.length === totalTextTracks) {\n            logger.error('Trying to add too many tracks.');\n            return;\n        }\n\n        textTrackQueue.push(textTrackInfoVO);\n\n        if (textTrackQueue.length === totalTextTracks) {\n            textTrackQueue.sort(function (a, b) { //Sort in same order as in manifest\n                return a.index - b.index;\n            });\n            captionContainer = videoModel.getTTMLRenderingDiv();\n            let defaultIndex = -1;\n            for (let i = 0 ; i < textTrackQueue.length; i++) {\n                const track = createTrackForUserAgent.call(this, i);\n                trackElementArr.push(track); //used to remove tracks from video element when added manually\n\n                if (textTrackQueue[i].defaultTrack) {\n                    // track.default is an object property identifier that is a reserved word\n                    // The following jshint directive is used to suppressed the warning \"Expected an identifier and instead saw 'default' (a reserved word)\"\n                    /*jshint -W024 */\n                    track.default = true;\n                    defaultIndex = i;\n                }\n\n                const textTrack = getTrackByIdx(i);\n                if (textTrack) {\n                    //each time a track is created, its mode should be showing by default\n                    //sometime, it's not on Chrome\n                    textTrack.mode = Constants.TEXT_SHOWING;\n                    if (captionContainer && (textTrackQueue[i].isTTML || textTrackQueue[i].isEmbedded)) {\n                        textTrack.renderingType = 'html';\n                    } else {\n                        textTrack.renderingType = 'default';\n                    }\n                }\n                this.addCaptions(i, 0, textTrackQueue[i].captionData);\n                eventBus.trigger(Events.TEXT_TRACK_ADDED);\n            }\n\n            //set current track index in textTrackQueue array\n            setCurrentTrackIdx.call(this, defaultIndex);\n\n            if (defaultIndex >= 0) {\n                for (let idx = 0; idx < textTrackQueue.length; idx++) {\n                    const videoTextTrack = getTrackByIdx(idx);\n                    if (videoTextTrack) {\n                        videoTextTrack.mode = (idx === defaultIndex) ? Constants.TEXT_SHOWING : Constants.TEXT_HIDDEN;\n                    }\n                }\n            }\n\n            eventBus.trigger(Events.TEXT_TRACKS_QUEUE_INITIALIZED, {\n                index: currentTrackIdx,\n                tracks: textTrackQueue\n            }); //send default idx.\n        }\n    }\n\n    function getVideoVisibleVideoSize(viewWidth, viewHeight, videoWidth, videoHeight, aspectRatio, use80Percent) {\n        const viewAspectRatio = viewWidth / viewHeight;\n        const videoAspectRatio = videoWidth / videoHeight;\n\n        let videoPictureWidth = 0;\n        let videoPictureHeight = 0;\n\n        if (viewAspectRatio > videoAspectRatio) {\n            videoPictureHeight = viewHeight;\n            videoPictureWidth = (videoPictureHeight / videoHeight) * videoWidth;\n        } else {\n            videoPictureWidth = viewWidth;\n            videoPictureHeight = (videoPictureWidth / videoWidth) * videoHeight;\n        }\n\n        let videoPictureXAspect = 0;\n        let videoPictureYAspect = 0;\n        let videoPictureWidthAspect = 0;\n        let videoPictureHeightAspect = 0;\n        const videoPictureAspect = videoPictureWidth / videoPictureHeight;\n\n        if (videoPictureAspect > aspectRatio) {\n            videoPictureHeightAspect = videoPictureHeight;\n            videoPictureWidthAspect = videoPictureHeight * aspectRatio;\n        } else {\n            videoPictureWidthAspect = videoPictureWidth;\n            videoPictureHeightAspect = videoPictureWidth / aspectRatio;\n        }\n        videoPictureXAspect = (viewWidth - videoPictureWidthAspect) / 2;\n        videoPictureYAspect = (viewHeight - videoPictureHeightAspect) / 2;\n\n        if (use80Percent) {\n            return {\n                x: videoPictureXAspect + (videoPictureWidthAspect * 0.1),\n                y: videoPictureYAspect + (videoPictureHeightAspect * 0.1),\n                w: videoPictureWidthAspect * 0.8,\n                h: videoPictureHeightAspect * 0.8\n            }; /* Maximal picture size in videos aspect ratio */\n        } else {\n            return {\n                x: videoPictureXAspect,\n                y: videoPictureYAspect,\n                w: videoPictureWidthAspect,\n                h: videoPictureHeightAspect\n            }; /* Maximal picture size in videos aspect ratio */\n        }\n    }\n\n    function checkVideoSize(track, forceDrawing) {\n        const clientWidth = videoModel.getClientWidth();\n        const clientHeight = videoModel.getClientHeight();\n        const videoWidth = videoModel.getVideoWidth();\n        const videoHeight = videoModel.getVideoHeight();\n        const videoOffsetTop = videoModel.getVideoRelativeOffsetTop();\n        const videoOffsetLeft = videoModel.getVideoRelativeOffsetLeft();\n        let aspectRatio =  videoWidth / videoHeight;\n        let use80Percent = false;\n        if (track.isFromCEA608) {\n            // If this is CEA608 then use predefined aspect ratio\n            aspectRatio = 3.5 / 3.0;\n            use80Percent = true;\n        }\n\n        const realVideoSize = getVideoVisibleVideoSize.call(this, clientWidth, clientHeight, videoWidth, videoHeight, aspectRatio, use80Percent);\n\n        const newVideoWidth = realVideoSize.w;\n        const newVideoHeight = realVideoSize.h;\n        const newVideoLeft = realVideoSize.x;\n        const newVideoTop = realVideoSize.y;\n\n        if (newVideoWidth != actualVideoWidth || newVideoHeight != actualVideoHeight || newVideoLeft != actualVideoLeft || newVideoTop != actualVideoTop || forceDrawing) {\n            actualVideoLeft = newVideoLeft + videoOffsetLeft;\n            actualVideoTop = newVideoTop + videoOffsetTop;\n            actualVideoWidth = newVideoWidth;\n            actualVideoHeight = newVideoHeight;\n\n            if (captionContainer) {\n                const containerStyle = captionContainer.style;\n                containerStyle.left = actualVideoLeft + 'px';\n                containerStyle.top = actualVideoTop + 'px';\n                containerStyle.width = actualVideoWidth + 'px';\n                containerStyle.height = actualVideoHeight + 'px';\n                containerStyle.zIndex = (fullscreenAttribute && document[fullscreenAttribute]) || displayCCOnTop ? topZIndex : null;\n                eventBus.trigger(Events.CAPTION_CONTAINER_RESIZE, {});\n            }\n\n            // Video view has changed size, so resize any active cues\n            const activeCues = track.activeCues;\n            if (activeCues) {\n                const len = activeCues.length;\n                for (let i = 0; i < len; ++i) {\n                    const cue = activeCues[i];\n                    cue.scaleCue(cue);\n                }\n            }\n        }\n    }\n\n    function scaleCue(activeCue) {\n        const videoWidth = actualVideoWidth;\n        const videoHeight = actualVideoHeight;\n        let key,\n            replaceValue,\n            valueFontSize,\n            valueLineHeight,\n            elements;\n\n        if (activeCue.cellResolution) {\n            const cellUnit = [videoWidth / activeCue.cellResolution[0], videoHeight / activeCue.cellResolution[1]];\n            if (activeCue.linePadding) {\n                for (key in activeCue.linePadding) {\n                    if (activeCue.linePadding.hasOwnProperty(key)) {\n                        const valueLinePadding = activeCue.linePadding[key];\n                        replaceValue = (valueLinePadding * cellUnit[0]).toString();\n                        // Compute the CellResolution unit in order to process properties using sizing (fontSize, linePadding, etc).\n                        const elementsSpan = document.getElementsByClassName('spanPadding');\n                        for (let i = 0; i < elementsSpan.length; i++) {\n                            elementsSpan[i].style.cssText = elementsSpan[i].style.cssText.replace(/(padding-left\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                            elementsSpan[i].style.cssText = elementsSpan[i].style.cssText.replace(/(padding-right\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                        }\n                    }\n                }\n            }\n\n            if (activeCue.fontSize) {\n                for (key in activeCue.fontSize) {\n                    if (activeCue.fontSize.hasOwnProperty(key)) {\n                        if (activeCue.fontSize[key][0] === '%') {\n                            valueFontSize = activeCue.fontSize[key][1] / 100;\n                        } else if (activeCue.fontSize[key][0] === 'c') {\n                            valueFontSize = activeCue.fontSize[key][1];\n                        }\n\n                        replaceValue = (valueFontSize * cellUnit[1]).toString();\n\n                        if (key !== 'defaultFontSize') {\n                            elements = document.getElementsByClassName(key);\n                        } else {\n                            elements = document.getElementsByClassName('paragraph');\n                        }\n\n                        for (let j = 0; j < elements.length; j++) {\n                            elements[j].style.cssText = elements[j].style.cssText.replace(/(font-size\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                        }\n                    }\n                }\n\n                if (activeCue.lineHeight) {\n                    for (key in activeCue.lineHeight) {\n                        if (activeCue.lineHeight.hasOwnProperty(key)) {\n                            if (activeCue.lineHeight[key][0] === '%') {\n                                valueLineHeight = activeCue.lineHeight[key][1] / 100;\n                            } else if (activeCue.fontSize[key][0] === 'c') {\n                                valueLineHeight = activeCue.lineHeight[key][1];\n                            }\n\n                            replaceValue = (valueLineHeight * cellUnit[1]).toString();\n                            elements = document.getElementsByClassName(key);\n                            for (let k = 0; k < elements.length; k++) {\n                                elements[k].style.cssText = elements[k].style.cssText.replace(/(line-height\\s*:\\s*)[\\d.,]+(?=\\s*px)/gi, '$1' + replaceValue);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        if (activeCue.isd) {\n            let htmlCaptionDiv = document.getElementById(activeCue.cueID);\n            if (htmlCaptionDiv) {\n                captionContainer.removeChild(htmlCaptionDiv);\n            }\n            renderCaption(activeCue);\n        }\n    }\n\n    function renderCaption(cue) {\n        if (captionContainer) {\n            const finalCue = document.createElement('div');\n            captionContainer.appendChild(finalCue);\n            previousISDState = renderHTML(cue.isd, finalCue, function (uri) {\n                const imsc1ImgUrnTester = /^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/;\n                const smpteImgUrnTester = /^#(.*)$/;\n                if (imsc1ImgUrnTester.test(uri)) {\n                    const match = imsc1ImgUrnTester.exec(uri);\n                    const imageId = parseInt(match[4], 10) - 1;\n                    const imageData = btoa(cue.images[imageId]);\n                    const dataUrl = 'data:image/png;base64,' + imageData;\n                    return dataUrl;\n                } else if (smpteImgUrnTester.test(uri)) {\n                    const match = smpteImgUrnTester.exec(uri);\n                    const imageId = match[1];\n                    const dataUrl = 'data:image/png;base64,' + cue.embeddedImages[imageId];\n                    return dataUrl;\n                } else {\n                    return null;\n                }\n            }, captionContainer.clientHeight, captionContainer.clientWidth, false/*displayForcedOnlyMode*/, function (err) {\n                logger.info('renderCaption :', err);\n                //TODO add ErrorHandler management\n            }, previousISDState, true /*enableRollUp*/);\n            finalCue.id = cue.cueID;\n            eventBus.trigger(Events.CAPTION_RENDERED, {captionDiv: finalCue, currentTrackIdx});\n        }\n    }\n\n    /*\n     * Add captions to track, store for later adding, or add captions added before\n     */\n    function addCaptions(trackIdx, timeOffset, captionData) {\n        const track = getTrackByIdx(trackIdx);\n        const self = this;\n\n        if (!track) {\n            return;\n        }\n\n        if (!captionData || captionData.length === 0) {\n            return;\n        }\n\n        for (let item = 0; item < captionData.length; item++) {\n            let cue;\n            const currentItem = captionData[item];\n\n            track.cellResolution = currentItem.cellResolution;\n            track.isFromCEA608 = currentItem.isFromCEA608;\n\n            if (currentItem.type === 'html' && captionContainer) {\n                cue = new Cue(currentItem.start - timeOffset, currentItem.end - timeOffset, '');\n                cue.cueHTMLElement = currentItem.cueHTMLElement;\n                cue.isd = currentItem.isd;\n                cue.images = currentItem.images;\n                cue.embeddedImages = currentItem.embeddedImages;\n                cue.cueID = currentItem.cueID;\n                cue.scaleCue = scaleCue.bind(self);\n                //useful parameters for cea608 subtitles, not for TTML one.\n                cue.cellResolution = currentItem.cellResolution;\n                cue.lineHeight = currentItem.lineHeight;\n                cue.linePadding = currentItem.linePadding;\n                cue.fontSize = currentItem.fontSize;\n\n                captionContainer.style.left = actualVideoLeft + 'px';\n                captionContainer.style.top = actualVideoTop + 'px';\n                captionContainer.style.width = actualVideoWidth + 'px';\n                captionContainer.style.height = actualVideoHeight + 'px';\n\n                cue.onenter = function () {\n                    if (track.mode === Constants.TEXT_SHOWING) {\n                        if (this.isd) {\n                            renderCaption(this);\n                            logger.debug('Cue enter id:' + this.cueID);\n                        } else {\n                            captionContainer.appendChild(this.cueHTMLElement);\n                            scaleCue.call(self, this);\n                            eventBus.trigger(Events.CAPTION_RENDERED, {captionDiv: this.cueHTMLElement, currentTrackIdx});\n                        }\n                    }\n                };\n\n                cue.onexit = function () {\n                    if (captionContainer) {\n                        const divs = captionContainer.childNodes;\n                        for (let i = 0; i < divs.length; ++i) {\n                            if (divs[i].id === this.cueID) {\n                                logger.debug('Cue exit id:' + divs[i].id);\n                                captionContainer.removeChild(divs[i]);\n                            }\n                        }\n                    }\n                };\n            } else {\n                if (currentItem.data) {\n                    cue = new Cue(currentItem.start - timeOffset, currentItem.end - timeOffset, currentItem.data);\n                    if (currentItem.styles) {\n                        if (currentItem.styles.align !== undefined && 'align' in cue) {\n                            cue.align = currentItem.styles.align;\n                        }\n                        if (currentItem.styles.line !== undefined && 'line' in cue) {\n                            cue.line = currentItem.styles.line;\n                        }\n                        if (currentItem.styles.position !== undefined && 'position' in cue) {\n                            cue.position = currentItem.styles.position;\n                        }\n                        if (currentItem.styles.size !== undefined && 'size' in cue) {\n                            cue.size = currentItem.styles.size;\n                        }\n                    }\n                    cue.onenter = function () {\n                        if (track.mode === Constants.TEXT_SHOWING) {\n                            eventBus.trigger(Events.CAPTION_RENDERED, {currentTrackIdx});\n                        }\n                    };\n                }\n            }\n            try {\n                if (cue) {\n                    track.addCue(cue);\n                } else {\n                    logger.error('impossible to display subtitles.');\n                }\n            } catch (e) {\n                // Edge crash, delete everything and start adding again\n                // @see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11979877/\n                deleteTrackCues(track);\n                track.addCue(cue);\n                throw e;\n            }\n        }\n    }\n\n    function getTrackByIdx(idx) {\n        return idx >= 0 && textTrackQueue[idx] ?\n            videoModel.getTextTrack(textTrackQueue[idx].kind, textTrackQueue[idx].id, textTrackQueue[idx].lang, textTrackQueue[idx].isTTML, textTrackQueue[idx].isEmbedded) : null;\n    }\n\n    function getCurrentTrackIdx() {\n        return currentTrackIdx;\n    }\n\n    function getTrackIdxForId(trackId) {\n        let idx = -1;\n        for (let i = 0; i < textTrackQueue.length; i++) {\n            if (textTrackQueue[i].id === trackId) {\n                idx = i;\n                break;\n            }\n        }\n\n        return idx;\n    }\n\n    function setCurrentTrackIdx(idx) {\n        if (idx === currentTrackIdx) {\n            return;\n        }\n        currentTrackIdx = idx;\n        const track = getTrackByIdx(currentTrackIdx);\n        setCueStyleOnTrack.call(this, track);\n\n        if (videoSizeCheckInterval) {\n            clearInterval(videoSizeCheckInterval);\n            videoSizeCheckInterval = null;\n        }\n\n        if (track && track.renderingType === 'html') {\n            checkVideoSize.call(this, track, true);\n            videoSizeCheckInterval = setInterval(checkVideoSize.bind(this, track), 500);\n        }\n    }\n\n    function setCueStyleOnTrack(track) {\n        clearCaptionContainer.call(this);\n        if (track) {\n            if (track.renderingType === 'html') {\n                setNativeCueStyle.call(this);\n            } else {\n                removeNativeCueStyle.call(this);\n            }\n        } else {\n            removeNativeCueStyle.call(this);\n        }\n    }\n\n    function deleteTrackCues(track) {\n        if (track.cues) {\n            const cues = track.cues;\n            const lastIdx = cues.length - 1;\n\n            for (let r = lastIdx; r >= 0 ; r--) {\n                track.removeCue(cues[r]);\n            }\n        }\n    }\n\n    function deleteCuesFromTrackIdx(trackIdx) {\n        const track = getTrackByIdx(trackIdx);\n        if (track) {\n            deleteTrackCues(track);\n        }\n    }\n\n    function deleteAllTextTracks() {\n        const ln = trackElementArr ? trackElementArr.length : 0;\n        for (let i = 0; i < ln; i++) {\n            const track = getTrackByIdx(i);\n            if (track) {\n                deleteTrackCues.call(this, track);\n                track.mode = 'disabled';\n            }\n        }\n        trackElementArr = [];\n        textTrackQueue = [];\n        if (videoSizeCheckInterval) {\n            clearInterval(videoSizeCheckInterval);\n            videoSizeCheckInterval = null;\n        }\n        currentTrackIdx = -1;\n        clearCaptionContainer.call(this);\n    }\n\n    function deleteTextTrack(idx) {\n        videoModel.removeChild(trackElementArr[idx]);\n        trackElementArr.splice(idx, 1);\n    }\n\n    /* Set native cue style to transparent background to avoid it being displayed. */\n    function setNativeCueStyle() {\n        let styleElement = document.getElementById('native-cue-style');\n        if (styleElement) {\n            return; //Already set\n        }\n\n        styleElement = document.createElement('style');\n        styleElement.id = 'native-cue-style';\n        document.head.appendChild(styleElement);\n        const stylesheet = styleElement.sheet;\n        const video = videoModel.getElement();\n        try {\n            if (video) {\n                if (video.id) {\n                    stylesheet.insertRule('#' + video.id + '::cue {background: transparent}', 0);\n                } else if (video.classList.length !== 0) {\n                    stylesheet.insertRule('.' + video.className + '::cue {background: transparent}', 0);\n                } else {\n                    stylesheet.insertRule('video::cue {background: transparent}', 0);\n                }\n            }\n        } catch (e) {\n            logger.info('' + e.message);\n        }\n    }\n\n    /* Remove the extra cue style with transparent background for native cues. */\n    function removeNativeCueStyle() {\n        const styleElement = document.getElementById('native-cue-style');\n        if (styleElement) {\n            document.head.removeChild(styleElement);\n        }\n    }\n\n    function clearCaptionContainer() {\n        if (captionContainer) {\n            while (captionContainer.firstChild) {\n                captionContainer.removeChild(captionContainer.firstChild);\n            }\n        }\n    }\n\n    function setConfig(config) {\n        if (!config) {\n            return;\n        }\n        if (config.videoModel) {\n            videoModel = config.videoModel;\n        }\n    }\n\n    function setModeForTrackIdx(idx, mode) {\n        const track = getTrackByIdx(idx);\n        if (track && track.mode !== mode) {\n            track.mode = mode;\n        }\n    }\n\n    function getCurrentTrackInfo() {\n        return textTrackQueue[currentTrackIdx];\n    }\n\n    instance = {\n        initialize: initialize,\n        displayCConTop: displayCConTop,\n        addTextTrack: addTextTrack,\n        addCaptions: addCaptions,\n        getCurrentTrackIdx: getCurrentTrackIdx,\n        setCurrentTrackIdx: setCurrentTrackIdx,\n        getTrackIdxForId: getTrackIdxForId,\n        getCurrentTrackInfo: getCurrentTrackInfo,\n        setModeForTrackIdx: setModeForTrackIdx,\n        deleteCuesFromTrackIdx: deleteCuesFromTrackIdx,\n        deleteAllTextTracks: deleteAllTextTracks,\n        deleteTextTrack: deleteTextTrack,\n        setConfig: setConfig\n    };\n\n    setup();\n\n    return instance;\n}\n\nTextTracks.__dashjs_factory_name = 'TextTracks';\nexport default FactoryMaker.getSingletonFactory(TextTracks);\n"]}