{"version":3,"sources":["../../../../src/dash/DashAdapter.js"],"names":["Constants","DashConstants","RepresentationInfo","MediaInfo","StreamInfo","ManifestInfo","Event","FactoryMaker","cea608parser","checkInteger","DashAdapter","instance","dashManifestModel","voPeriods","voAdaptations","currentMediaInfo","setup","reset","setConfig","config","getRepresentationForRepresentationInfo","representationInfo","representationController","getRepresentationForQuality","quality","getAdaptationForMediaInfo","mediaInfo","streamInfo","id","undefined","index","getPeriodForStreamInfo","voPeriodsArray","ln","length","i","voPeriod","convertRepresentationToRepresentationInfo","voRepresentation","realAdaptation","adaptation","period","mpd","manifest","Period_asArray","AdaptationSet_asArray","realRepresentation","getRepresentationFor","bandwidth","getBandwidth","DVRWindow","segmentAvailabilityRange","fragmentDuration","segmentDuration","segments","duration","NaN","MSETimeOffset","useCalculatedLiveEdgeTime","convertAdaptationToMediaInfo","viewpoint","type","convertPeriodToStreamInfo","representationCount","getRepresentationCount","labels","getLabelsForAdaptation","lang","getLanguageForAdaptation","getViewpointForAdaptation","value","accessibility","getAccessibilityForAdaptation","map","accessibilityValue","accessibilityData","schemeIdUri","search","embeddedCaptions","audioChannelConfiguration","getAudioChannelConfigurationForAdaptation","roles","getRolesForAdaptation","role","codec","getCodec","mimeType","getMimeType","contentProtection","getContentProtectionData","bitrateList","getBitrateListForAdaptation","forEach","item","KID","getKID","isText","getIsTextTrack","convertVideoInfoToEmbeddedTextInfo","channel","parseInt","substring","EMBEDDED_TEXT","isEmbedded","convertVideoInfoToThumbnailInfo","IMAGE","THRESHOLD","start","manifestInfo","convertMpdToManifestInfo","isLast","Math","abs","DVRWindowSize","timeShiftBufferDepth","loadedTime","availableFrom","availabilityStartTime","minBufferTime","maxFragmentDuration","maxSegmentDuration","getDuration","isDynamic","getIsDynamic","getMediaInfoForType","getAdaptationForType","selectedVoPeriod","periodId","idx","getIndexForAdaptation","getAdaptationsForPeriod","getIsMain","filter","MAIN","periodIndex","adaptations","getAdaptationsForType","allMediaInfoForType","getAllMediaInfoForType","isMediaInfoEqual","externalManifest","voLocalPeriods","mediaArr","data","media","j","checkSetConfigCall","getMpd","getRegularPeriods","adaptationsForType","VIDEO","accessibilityLength","indexOf","parts","split","call","push","CC1","hasOwnProperty","Error","updatePeriods","newManifest","getStreamsInfo","maxStreamsInfo","streams","checkStreamProcessor","streamProcessor","checkRepresentationController","getInitRequest","representation","indexHandler","getRepresentationController","getIndexHandler","getFragmentRequest","time","options","fragRequest","getSegmentRequestForTime","getNextSegmentRequest","getIndexHandlerTime","getCurrentTime","setIndexHandlerTime","setCurrentTime","resetIndexHandler","resetIndex","updateData","getStreamInfo","getMediaInfo","voAdaptation","getType","getAdaptationForId","getAdaptationForIndex","getRepresentationInfo","getCurrentRepresentation","getEvent","eventBox","eventStreams","startTime","event","scheme_id_uri","timescale","presentationTimeDelta","presentation_time_delta","event_duration","messageData","message_data","presentationTime","eventStream","getEventsFor","info","events","getEventsForPeriod","getEventStreamForAdaptationSet","getEventStreamForRepresentation","setCurrentMediaInfo","streamId","convertDataToRepresentationInfo","getDataForMedia","__dashjs_factory_name","getSingletonFactory"],"mappings":"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","file":"DashAdapter.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport Constants from '../streaming/constants/Constants';\nimport DashConstants from './constants/DashConstants';\nimport RepresentationInfo from '../streaming/vo/RepresentationInfo';\nimport MediaInfo from '../streaming/vo/MediaInfo';\nimport StreamInfo from '../streaming/vo/StreamInfo';\nimport ManifestInfo from '../streaming/vo/ManifestInfo';\nimport Event from './vo/Event';\nimport FactoryMaker from '../core/FactoryMaker';\nimport cea608parser from '../../externals/cea608-parser';\nimport { checkInteger } from '../streaming/utils/SupervisorTools';\n\nfunction DashAdapter() {\n    let instance,\n        dashManifestModel,\n        voPeriods,\n        voAdaptations,\n        currentMediaInfo;\n\n    function setup() {\n        reset();\n    }\n\n    function setConfig(config) {\n        if (!config) return;\n\n        if (config.dashManifestModel) {\n            dashManifestModel = config.dashManifestModel;\n        }\n    }\n\n    function getRepresentationForRepresentationInfo(representationInfo, representationController) {\n        return representationController && representationInfo ? representationController.getRepresentationForQuality(representationInfo.quality) : null;\n    }\n\n    function getAdaptationForMediaInfo(mediaInfo) {\n\n        if (!mediaInfo || !mediaInfo.streamInfo || mediaInfo.streamInfo.id === undefined || !voAdaptations[mediaInfo.streamInfo.id]) return null;\n        return voAdaptations[mediaInfo.streamInfo.id][mediaInfo.index];\n    }\n\n    function getPeriodForStreamInfo(streamInfo, voPeriodsArray) {\n        const ln = voPeriodsArray.length;\n\n        for (let i = 0; i < ln; i++) {\n            let voPeriod = voPeriodsArray[i];\n\n            if (streamInfo.id === voPeriod.id) return voPeriod;\n        }\n\n        return null;\n    }\n\n    function convertRepresentationToRepresentationInfo(voRepresentation) {\n        let representationInfo = new RepresentationInfo();\n        const realAdaptation = voRepresentation.adaptation.period.mpd.manifest.Period_asArray[voRepresentation.adaptation.period.index].AdaptationSet_asArray[voRepresentation.adaptation.index];\n        const realRepresentation = dashManifestModel.getRepresentationFor(voRepresentation.index, realAdaptation);\n\n        representationInfo.id = voRepresentation.id;\n        representationInfo.quality = voRepresentation.index;\n        representationInfo.bandwidth = dashManifestModel.getBandwidth(realRepresentation);\n        representationInfo.DVRWindow = voRepresentation.segmentAvailabilityRange;\n        representationInfo.fragmentDuration = voRepresentation.segmentDuration || (voRepresentation.segments && voRepresentation.segments.length > 0 ? voRepresentation.segments[0].duration : NaN);\n        representationInfo.MSETimeOffset = voRepresentation.MSETimeOffset;\n        representationInfo.useCalculatedLiveEdgeTime = voRepresentation.useCalculatedLiveEdgeTime;\n        representationInfo.mediaInfo = convertAdaptationToMediaInfo(voRepresentation.adaptation);\n\n        return representationInfo;\n    }\n\n    function convertAdaptationToMediaInfo(adaptation) {\n        let mediaInfo = new MediaInfo();\n        const realAdaptation = adaptation.period.mpd.manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index];\n        let viewpoint;\n\n        mediaInfo.id = adaptation.id;\n        mediaInfo.index = adaptation.index;\n        mediaInfo.type = adaptation.type;\n        mediaInfo.streamInfo = convertPeriodToStreamInfo(adaptation.period);\n        mediaInfo.representationCount = dashManifestModel.getRepresentationCount(realAdaptation);\n        mediaInfo.labels = dashManifestModel.getLabelsForAdaptation(realAdaptation);\n        mediaInfo.lang = dashManifestModel.getLanguageForAdaptation(realAdaptation);\n        viewpoint = dashManifestModel.getViewpointForAdaptation(realAdaptation);\n        mediaInfo.viewpoint = viewpoint ? viewpoint.value : undefined;\n        mediaInfo.accessibility = dashManifestModel.getAccessibilityForAdaptation(realAdaptation).map(function (accessibility) {\n            let accessibilityValue = accessibility.value;\n            let accessibilityData = accessibilityValue;\n            if (accessibility.schemeIdUri && (accessibility.schemeIdUri.search('cea-608') >= 0) && typeof (cea608parser) !== 'undefined') {\n                if (accessibilityValue) {\n                    accessibilityData = 'cea-608:' + accessibilityValue;\n                } else {\n                    accessibilityData = 'cea-608';\n                }\n                mediaInfo.embeddedCaptions = true;\n            }\n            return accessibilityData;\n        });\n\n        mediaInfo.audioChannelConfiguration = dashManifestModel.getAudioChannelConfigurationForAdaptation(realAdaptation).map(function (audioChannelConfiguration) {\n            return audioChannelConfiguration.value;\n        });\n        mediaInfo.roles = dashManifestModel.getRolesForAdaptation(realAdaptation).map(function (role) {\n            return role.value;\n        });\n        mediaInfo.codec = dashManifestModel.getCodec(realAdaptation);\n        mediaInfo.mimeType = dashManifestModel.getMimeType(realAdaptation);\n        mediaInfo.contentProtection = dashManifestModel.getContentProtectionData(realAdaptation);\n        mediaInfo.bitrateList = dashManifestModel.getBitrateListForAdaptation(realAdaptation);\n\n        if (mediaInfo.contentProtection) {\n            mediaInfo.contentProtection.forEach(function (item) {\n                item.KID = dashManifestModel.getKID(item);\n            });\n        }\n\n        mediaInfo.isText = dashManifestModel.getIsTextTrack(mediaInfo.mimeType);\n\n        return mediaInfo;\n    }\n\n    function convertVideoInfoToEmbeddedTextInfo(mediaInfo, channel, lang) {\n        mediaInfo.id = channel; // CC1, CC2, CC3, or CC4\n        mediaInfo.index = 100 + parseInt(channel.substring(2, 3));\n        mediaInfo.type = Constants.EMBEDDED_TEXT;\n        mediaInfo.codec = 'cea-608-in-SEI';\n        mediaInfo.isText = true;\n        mediaInfo.isEmbedded = true;\n        mediaInfo.lang = lang;\n        mediaInfo.roles = ['caption'];\n    }\n\n    function convertVideoInfoToThumbnailInfo(mediaInfo) {\n        mediaInfo.type = Constants.IMAGE;\n    }\n\n    function convertPeriodToStreamInfo(period) {\n        let streamInfo = new StreamInfo();\n        const THRESHOLD = 1;\n\n        streamInfo.id = period.id;\n        streamInfo.index = period.index;\n        streamInfo.start = period.start;\n        streamInfo.duration = period.duration;\n        streamInfo.manifestInfo = convertMpdToManifestInfo(period.mpd);\n        streamInfo.isLast = period.mpd.manifest.Period_asArray.length === 1 || Math.abs((streamInfo.start + streamInfo.duration) - streamInfo.manifestInfo.duration) < THRESHOLD;\n\n        return streamInfo;\n    }\n\n    function convertMpdToManifestInfo(mpd) {\n        let manifestInfo = new ManifestInfo();\n\n        manifestInfo.DVRWindowSize = mpd.timeShiftBufferDepth;\n        manifestInfo.loadedTime = mpd.manifest.loadedTime;\n        manifestInfo.availableFrom = mpd.availabilityStartTime;\n        manifestInfo.minBufferTime = mpd.manifest.minBufferTime;\n        manifestInfo.maxFragmentDuration = mpd.maxSegmentDuration;\n        manifestInfo.duration = dashManifestModel.getDuration(mpd.manifest);\n        manifestInfo.isDynamic = dashManifestModel.getIsDynamic(mpd.manifest);\n\n        return manifestInfo;\n    }\n\n    function getMediaInfoForType(streamInfo, type) {\n\n        if (voPeriods.length === 0) {\n            return null;\n        }\n\n        const manifest = voPeriods[0].mpd.manifest;\n        let realAdaptation = getAdaptationForType(manifest, streamInfo.index, type, streamInfo);\n        if (!realAdaptation) return null;\n\n        let selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voPeriods);\n        let periodId = selectedVoPeriod.id;\n        let idx = dashManifestModel.getIndexForAdaptation(realAdaptation, manifest, streamInfo.index);\n\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\n\n        return convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\n    }\n\n    function getIsMain(adaptation) {\n        return dashManifestModel.getRolesForAdaptation(adaptation).filter(function (role) {\n            return role.value === DashConstants.MAIN;\n        })[0];\n    }\n\n    function getAdaptationForType(manifest, periodIndex, type, streamInfo) {\n        const adaptations = dashManifestModel.getAdaptationsForType(manifest, periodIndex, type);\n\n        if (!adaptations || adaptations.length === 0) return null;\n\n        if (adaptations.length > 1 && streamInfo) {\n            const allMediaInfoForType = getAllMediaInfoForType(streamInfo, type);\n\n            if (currentMediaInfo[streamInfo.id] && currentMediaInfo[streamInfo.id][type]) {\n                for (let i = 0, ln = adaptations.length; i < ln; i++) {\n                    if (currentMediaInfo[streamInfo.id][type].isMediaInfoEqual(allMediaInfoForType[i])) {\n                        return adaptations[i];\n                    }\n                }\n            }\n\n            for (let i = 0, ln = adaptations.length; i < ln; i++) {\n                if (getIsMain(adaptations[i])) {\n                    return adaptations[i];\n                }\n            }\n        }\n\n        return adaptations[0];\n    }\n\n    function getAllMediaInfoForType(streamInfo, type, externalManifest) {\n        let voLocalPeriods = voPeriods;\n        let manifest = externalManifest;\n        let mediaArr = [];\n        let data,\n            media,\n            idx,\n            i,\n            j,\n            ln;\n\n        if (manifest) {\n            checkSetConfigCall();\n            const mpd = dashManifestModel.getMpd(manifest);\n\n            voLocalPeriods = dashManifestModel.getRegularPeriods(mpd);\n        } else {\n            if (voPeriods.length > 0) {\n                manifest = voPeriods[0].mpd.manifest;\n            } else {\n                return mediaArr;\n            }\n        }\n\n        const selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voLocalPeriods);\n        const periodId = selectedVoPeriod.id;\n        const adaptationsForType = dashManifestModel.getAdaptationsForType(manifest, streamInfo.index, type !== Constants.EMBEDDED_TEXT ? type : Constants.VIDEO);\n\n        if (!adaptationsForType) return mediaArr;\n\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\n\n        for (i = 0, ln = adaptationsForType.length; i < ln; i++) {\n            data = adaptationsForType[i];\n            idx = dashManifestModel.getIndexForAdaptation(data, manifest, streamInfo.index);\n            media = convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\n\n            if (type === Constants.EMBEDDED_TEXT) {\n                let accessibilityLength = media.accessibility.length;\n                for (j = 0; j < accessibilityLength; j++) {\n                    if (!media) {\n                        continue;\n                    }\n                    let accessibility = media.accessibility[j];\n                    if (accessibility.indexOf('cea-608:') === 0) {\n                        let value = accessibility.substring(8);\n                        let parts = value.split(';');\n                        if (parts[0].substring(0, 2) === 'CC') {\n                            for (j = 0; j < parts.length; j++) {\n                                if (!media) {\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\n                                }\n                                convertVideoInfoToEmbeddedTextInfo(media, parts[j].substring(0, 3), parts[j].substring(4));\n                                mediaArr.push(media);\n                                media = null;\n                            }\n                        } else {\n                            for (j = 0; j < parts.length; j++) { // Only languages for CC1, CC2, ...\n                                if (!media) {\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\n                                }\n                                convertVideoInfoToEmbeddedTextInfo(media, 'CC' + (j + 1), parts[j]);\n                                mediaArr.push(media);\n                                media = null;\n                            }\n                        }\n                    } else if (accessibility.indexOf('cea-608') === 0) { // Nothing known. We interpret it as CC1=eng\n                        convertVideoInfoToEmbeddedTextInfo(media, Constants.CC1, 'eng');\n                        mediaArr.push(media);\n                        media = null;\n                    }\n                }\n            } else if (type === Constants.IMAGE) {\n                convertVideoInfoToThumbnailInfo(media);\n                mediaArr.push(media);\n                media = null;\n            } else if (media) {\n                mediaArr.push(media);\n            }\n        }\n\n        return mediaArr;\n    }\n\n    function checkSetConfigCall() {\n        if (!dashManifestModel || !dashManifestModel.hasOwnProperty('getMpd') || !dashManifestModel.hasOwnProperty('getRegularPeriods')) {\n            throw new Error('setConfig function has to be called previously');\n        }\n    }\n\n    function updatePeriods(newManifest) {\n        if (!newManifest) return null;\n\n        checkSetConfigCall();\n\n        const mpd = dashManifestModel.getMpd(newManifest);\n\n        voPeriods = dashManifestModel.getRegularPeriods(mpd);\n        voAdaptations = {};\n    }\n\n    function getStreamsInfo(externalManifest, maxStreamsInfo) {\n        const streams = [];\n        let voLocalPeriods = voPeriods;\n\n        //if manifest is defined, getStreamsInfo is for an outside manifest, not the current one\n        if (externalManifest) {\n            checkSetConfigCall();\n            const mpd = dashManifestModel.getMpd(externalManifest);\n\n            voLocalPeriods = dashManifestModel.getRegularPeriods(mpd);\n        }\n\n        if (!maxStreamsInfo) {\n            maxStreamsInfo = voLocalPeriods.length;\n        }\n        for (let i = 0; i < maxStreamsInfo; i++) {\n            streams.push(convertPeriodToStreamInfo(voLocalPeriods[i]));\n        }\n\n        return streams;\n    }\n\n    function checkStreamProcessor(streamProcessor) {\n        if (!streamProcessor || !streamProcessor.hasOwnProperty('getRepresentationController') || !streamProcessor.hasOwnProperty('getIndexHandler') ||\n            !streamProcessor.hasOwnProperty('getMediaInfo') || !streamProcessor.hasOwnProperty('getType') || !streamProcessor.hasOwnProperty('getStreamInfo')) {\n            throw new Error('streamProcessor parameter is missing or malformed!');\n        }\n    }\n\n    function checkRepresentationController(representationController) {\n        if (!representationController || !representationController.hasOwnProperty('getRepresentationForQuality') || !representationController.hasOwnProperty('getCurrentRepresentation')) {\n            throw new Error('representationController parameter is missing or malformed!');\n        }\n    }\n\n    function getInitRequest(streamProcessor, quality) {\n        let representationController,\n            representation,\n            indexHandler;\n\n        checkStreamProcessor(streamProcessor);\n        checkInteger(quality);\n\n        representationController = streamProcessor.getRepresentationController();\n        indexHandler = streamProcessor.getIndexHandler();\n\n        representation = representationController ? representationController.getRepresentationForQuality(quality) : null;\n\n        return indexHandler ? indexHandler.getInitRequest(representation) : null;\n    }\n\n    function getFragmentRequest(streamProcessor, representationInfo, time, options) {\n        let representationController,\n            representation,\n            indexHandler;\n\n        let fragRequest = null;\n\n        checkStreamProcessor(streamProcessor);\n\n        representationController = streamProcessor.getRepresentationController();\n        representation = getRepresentationForRepresentationInfo(representationInfo, representationController);\n        indexHandler = streamProcessor.getIndexHandler();\n\n        if (indexHandler) {\n            //if time and options are undefined, it means the next segment is requested\n            //otherwise, the segment at this specific time is requested.\n            if (time !== undefined && options !== undefined) {\n                fragRequest = indexHandler.getSegmentRequestForTime(representation, time, options);\n            } else {\n                fragRequest = indexHandler.getNextSegmentRequest(representation);\n            }\n        }\n\n        return fragRequest;\n    }\n\n    function getIndexHandlerTime(streamProcessor) {\n        checkStreamProcessor(streamProcessor);\n\n        const indexHandler = streamProcessor.getIndexHandler();\n\n        return indexHandler ? indexHandler.getCurrentTime() : NaN;\n    }\n\n    function setIndexHandlerTime(streamProcessor, value) {\n        checkStreamProcessor(streamProcessor);\n\n        const indexHandler = streamProcessor.getIndexHandler();\n        if (indexHandler) {\n            indexHandler.setCurrentTime(value);\n        }\n    }\n\n    function resetIndexHandler(streamProcessor) {\n        checkStreamProcessor(streamProcessor);\n\n        const indexHandler = streamProcessor.getIndexHandler();\n        if (indexHandler) {\n            indexHandler.resetIndex();\n        }\n    }\n\n    function updateData(streamProcessor) {\n        checkStreamProcessor(streamProcessor);\n\n        const selectedVoPeriod = getPeriodForStreamInfo(streamProcessor.getStreamInfo(), voPeriods);\n        const mediaInfo = streamProcessor.getMediaInfo();\n        const voAdaptation = getAdaptationForMediaInfo(mediaInfo);\n        const type = streamProcessor.getType();\n\n        let id,\n            realAdaptation;\n\n        id = mediaInfo ? mediaInfo.id : null;\n        if (voPeriods.length > 0) {\n            realAdaptation = id ? dashManifestModel.getAdaptationForId(id, voPeriods[0].mpd.manifest, selectedVoPeriod.index) : dashManifestModel.getAdaptationForIndex(mediaInfo.index, voPeriods[0].mpd.manifest, selectedVoPeriod.index);\n            streamProcessor.getRepresentationController().updateData(realAdaptation, voAdaptation, type);\n        }\n    }\n\n    /**\n     * Get a specific voRepresentation. If quality parameter is defined, this function will return the voRepresentation for this quality.\n     * Otherwise, this function will return the current voRepresentation used by the representationController.\n     * @param {RepresentationController} representationController - RepresentationController reference\n     * @param {number} quality - quality index of the voRepresentaion expected.\n     */\n    function getRepresentationInfo(representationController, quality) {\n        checkRepresentationController(representationController);\n        let voRepresentation;\n\n        if (quality !== undefined) {\n            checkInteger(quality);\n            voRepresentation = representationController.getRepresentationForQuality(quality);\n        } else {\n            voRepresentation = representationController.getCurrentRepresentation();\n        }\n\n        return voRepresentation ? convertRepresentationToRepresentationInfo(voRepresentation) : null;\n    }\n\n    function getEvent(eventBox, eventStreams, startTime) {\n        if (!eventBox || !eventStreams) {\n            return null;\n        }\n        const event = new Event();\n        const schemeIdUri = eventBox.scheme_id_uri;\n        const value = eventBox.value;\n        const timescale = eventBox.timescale;\n        const presentationTimeDelta = eventBox.presentation_time_delta;\n        const duration = eventBox.event_duration;\n        const id = eventBox.id;\n        const messageData = eventBox.message_data;\n        const presentationTime = startTime * timescale + presentationTimeDelta;\n\n        if (!eventStreams[schemeIdUri + '/' + value]) return null;\n\n        event.eventStream = eventStreams[schemeIdUri + '/' + value];\n        event.eventStream.value = value;\n        event.eventStream.timescale = timescale;\n        event.duration = duration;\n        event.id = id;\n        event.presentationTime = presentationTime;\n        event.messageData = messageData;\n        event.presentationTimeDelta = presentationTimeDelta;\n\n        return event;\n    }\n\n    function getEventsFor(info, streamProcessor) {\n        let events = [];\n\n        if (voPeriods.length === 0) {\n            return events;\n        }\n\n        const manifest = voPeriods[0].mpd.manifest;\n\n        if (info instanceof StreamInfo) {\n            events = dashManifestModel.getEventsForPeriod(getPeriodForStreamInfo(info, voPeriods));\n        } else if (info instanceof MediaInfo) {\n            events = dashManifestModel.getEventStreamForAdaptationSet(manifest, getAdaptationForMediaInfo(info));\n        } else if (info instanceof RepresentationInfo) {\n            events = dashManifestModel.getEventStreamForRepresentation(manifest, getRepresentationForRepresentationInfo(info, streamProcessor.getRepresentationController()));\n        }\n\n        return events;\n    }\n\n    function setCurrentMediaInfo(streamId, type, mediaInfo) {\n        currentMediaInfo[streamId] = currentMediaInfo[streamId] || {};\n        currentMediaInfo[streamId][type] = currentMediaInfo[streamId][type] || {};\n        currentMediaInfo[streamId][type] = mediaInfo;\n    }\n\n    function reset() {\n        voPeriods = [];\n        voAdaptations = {};\n        currentMediaInfo = {};\n    }\n\n    instance = {\n        convertDataToRepresentationInfo: convertRepresentationToRepresentationInfo,\n        getDataForMedia: getAdaptationForMediaInfo,\n        getStreamsInfo: getStreamsInfo,\n        getMediaInfoForType: getMediaInfoForType,\n        getAllMediaInfoForType: getAllMediaInfoForType,\n        getRepresentationInfo: getRepresentationInfo,\n        getAdaptationForType: getAdaptationForType,\n        updateData: updateData,\n        getInitRequest: getInitRequest,\n        getFragmentRequest: getFragmentRequest,\n        getIndexHandlerTime: getIndexHandlerTime,\n        setIndexHandlerTime: setIndexHandlerTime,\n        getEventsFor: getEventsFor,\n        getEvent: getEvent,\n        setConfig: setConfig,\n        updatePeriods: updatePeriods,\n        reset: reset,\n        resetIndexHandler: resetIndexHandler,\n        setCurrentMediaInfo: setCurrentMediaInfo\n    };\n\n    setup();\n    return instance;\n}\n\nDashAdapter.__dashjs_factory_name = 'DashAdapter';\nexport default FactoryMaker.getSingletonFactory(DashAdapter);\n"]}